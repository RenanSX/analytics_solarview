!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){!function(t){function e(t,e,o,r,i,a){return 0<(t=(a-e)*(o-t)-(r-e)*(i-t))||!(0>t)}function o(t,o,r,i,a,h,n,s){return e(t,o,a,h,n,s)!==e(r,i,a,h,n,s)&&e(t,o,r,i,a,h)!==e(t,o,r,i,n,s)}function r(t,e,r,i,a,h,n,s){return o(t,e,t+r,e,a,h,n,s)||o(t+r,e,t+r,e+i,a,h,n,s)||o(t,e+i,t+r,e+i,a,h,n,s)||o(t,e,t,e+i,a,h,n,s)}function i(e){var o=this,r=Math.max(t.animObject(o.renderer.globalAnimation).duration,250),i=!o.hasRendered;e.apply(o,[].slice.call(arguments,1)),o.labelSeries=[],o.labelSeriesMaxSum=0,clearTimeout(o.seriesLabelTimer),h(o.series,function(e){var a=e.options.label,h=e.labelBySeries,n=h&&h.closest;a.enabled&&e.visible&&(e.graph||e.area)&&!e.isSeriesBoosting&&(o.labelSeries.push(e),a.minFontSize&&a.maxFontSize&&(e.sum=t.reduce(e.yData,function(t,e){return(t||0)+(e||0)},0),o.labelSeriesMaxSum=Math.max(o.labelSeriesMaxSum,e.sum)),i&&(r=Math.max(r,t.animObject(e.options.animation).duration)),n&&(void 0!==n[0].plotX?h.animate({x:n[0].plotX+n[1],y:n[0].plotY+n[2]}):h.attr({opacity:0})))}),o.seriesLabelTimer=t.syncTimeout(function(){o.drawSeriesLabels()},o.renderer.forExport?0:r)}var a=t.wrap,h=t.each,n=t.extend,s=t.isNumber,c=t.pick,l=t.Series,p=t.SVGRenderer,u=t.Chart;t.setOptions({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!0,connectorNeighbourDistance:24,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),p.prototype.symbols.connector=function(t,e,o,r,i){var a=i&&i.anchorX;i=i&&i.anchorY;var h,n,c=o/2;return s(a)&&s(i)&&(h=["M",a,i],0>(n=e-i)&&(n=-r-n),n<o&&(c=a<t+o/2?n:o-n),i>e+r?h.push("L",t+c,e+r):i<e?h.push("L",t+c,e):a<t?h.push("L",t,e+r/2):a>t+o&&h.push("L",t+o,e+r/2)),h||[]},l.prototype.getPointsOnGraph=function(){if(this.xAxis||this.yAxis){var t,e,o,r,i,a,h=this.points,n=[];i=(r=this.graph||this.area).element;var l=this.chart.inverted,p=this.xAxis;t=this.yAxis;var u=l?t.pos:p.pos,d=(l=l?p.pos:t.pos,p=c(this.options.label.onArea,!!this.area),t.getThreshold(this.options.threshold));if(this.getPointSpline&&i.getPointAtLength&&!p){for(r.toD&&(e=r.attr("d"),r.attr({d:r.toD})),a=i.getTotalLength(),o=0;o<a;o+=16)t=i.getPointAtLength(o),n.push({chartX:u+t.x,chartY:l+t.y,plotX:t.x,plotY:t.y});e&&r.attr({d:e}),(t=h[h.length-1]).chartX=u+t.plotX,t.chartY=l+t.plotY,n.push(t)}else for(a=h.length,o=0;o<a;o+=1){if(t=h[o],e=h[o-1],t.chartX=u+t.plotX,t.chartY=l+t.plotY,p&&(t.chartCenterY=l+(t.plotY+c(t.yBottom,d))/2),0<o&&(r=Math.abs(t.chartX-e.chartX),i=Math.abs(t.chartY-e.chartY),16<(r=Math.max(r,i))))for(r=Math.ceil(r/16),i=1;i<r;i+=1)n.push({chartX:e.chartX+i/r*(t.chartX-e.chartX),chartY:e.chartY+i/r*(t.chartY-e.chartY),chartCenterY:e.chartCenterY+i/r*(t.chartCenterY-e.chartCenterY),plotX:e.plotX+i/r*(t.plotX-e.plotX),plotY:e.plotY+i/r*(t.plotY-e.plotY)});s(t.plotY)&&n.push(t)}return n}},l.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},l.prototype.checkClearPoint=function(t,e,o,i){var a,h,n,s,l,p,u,d,x=Number.MAX_VALUE,b=Number.MAX_VALUE,g=this.options.label.connectorAllowed,f=c(this.options.label.onArea,!!this.area),y=this.chart;for(u=0;u<y.boxesToAvoid.length;u+=1)if(s=y.boxesToAvoid[u],d=t+o.width,n=e,l=e+o.height,!(t>s.right||d<s.left||n>s.bottom||l<s.top))return!1;for(u=0;u<y.series.length;u+=1)if(s=(n=y.series[u]).interpolatedPoints,n.visible&&s){for(d=1;d<s.length;d+=1){if(s[d].chartX>=t-16&&s[d-1].chartX<=t+o.width+16){if(r(t,e,o.width,o.height,s[d-1].chartX,s[d-1].chartY,s[d].chartX,s[d].chartY))return!1;this===n&&!a&&i&&(a=r(t-16,e-16,o.width+32,o.height+32,s[d-1].chartX,s[d-1].chartY,s[d].chartX,s[d].chartY))}!g&&!a||this===n&&!f||(l=t+o.width/2-s[d].chartX,p=e+o.height/2-s[d].chartY,x=Math.min(x,l*l+p*p))}if(!f&&g&&this===n&&(i&&!a||x<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(d=1;d<s.length;d+=1)(a=Math.min(Math.pow(t+o.width/2-s[d].chartX,2)+Math.pow(e+o.height/2-s[d].chartY,2),Math.pow(t-s[d].chartX,2)+Math.pow(e-s[d].chartY,2),Math.pow(t+o.width-s[d].chartX,2)+Math.pow(e-s[d].chartY,2),Math.pow(t+o.width-s[d].chartX,2)+Math.pow(e+o.height-s[d].chartY,2),Math.pow(t-s[d].chartX,2)+Math.pow(e+o.height-s[d].chartY,2)))<b&&(b=a,h=s[d]);a=!0}}return!(i&&!a)&&{x:t,y:e,weight:x-(h?b:0),connectorPoint:h}},u.prototype.drawSeriesLabels=function(){var t=this,e=this.labelSeries;t.boxesToAvoid=[],h(e,function(e){e.interpolatedPoints=e.getPointsOnGraph(),h(e.options.label.boxesToAvoid||[],function(e){t.boxesToAvoid.push(e)})}),h(t.series,function(e){function o(t,e,o){return t>p&&t<=p+d-o.width&&e>=u&&e<=u+x-o.height}if(e.xAxis||e.yAxis){var r,i,a,h,s,l=[];r=e.options.label;var p=(f=t.inverted)?e.yAxis.pos:e.xAxis.pos,u=f?e.xAxis.pos:e.yAxis.pos,d=t.inverted?e.yAxis.len:e.xAxis.len,x=t.inverted?e.xAxis.len:e.yAxis.len,b=e.interpolatedPoints,g=c(r.onArea,!!e.area),f=e.labelBySeries;if(i=r.minFontSize,r=r.maxFontSize,e.visible&&!e.isSeriesBoosting&&b){for(f||(e.labelBySeries=f=t.renderer.label(e.name,0,-9999,"connector").css(n({color:g?t.renderer.getContrast(e.color):e.color},e.options.label.style)),i&&r&&f.css({fontSize:e.labelFontSize(i,r)}),f.attr({padding:0,opacity:t.renderer.forExport?1:0,stroke:e.color,"stroke-width":1,zIndex:3}).add(e.group).animate({opacity:1},{duration:200})),(r=f.getBBox()).width=Math.round(r.width),s=b.length-1;0<s;--s)g?(i=b[s].chartX-r.width/2,a=b[s].chartCenterY-r.height/2):(o(i=b[s].chartX+3,a=b[s].chartY-r.height-3,r)&&(h=e.checkClearPoint(i,a,r)),h&&l.push(h),o(i=b[s].chartX+3,a=b[s].chartY+3,r)&&(h=e.checkClearPoint(i,a,r)),h&&l.push(h),o(i=b[s].chartX-r.width-3,a=b[s].chartY+3,r)&&(h=e.checkClearPoint(i,a,r)),h&&l.push(h),i=b[s].chartX-r.width-3,a=b[s].chartY-r.height-3),o(i,a,r)&&(h=e.checkClearPoint(i,a,r)),h&&l.push(h);if(!l.length&&!g)for(i=p+d-r.width;i>=p;i-=16)for(a=u;a<u+x-r.height;a+=16)(h=e.checkClearPoint(i,a,r,!0))&&l.push(h);l.length?(l.sort(function(t,e){return e.weight-t.weight}),h=l[0],t.boxesToAvoid.push({left:h.x,right:h.x+r.width,top:h.y,bottom:h.y+r.height}),(l=Math.sqrt(Math.pow(Math.abs(h.x-f.x),2),Math.pow(Math.abs(h.y-f.y),2)))&&(b={opacity:t.renderer.forExport?1:0,x:h.x-p,y:h.y-u},g={opacity:1},10>=l&&(g={x:b.x,y:b.y},b={}),e.labelBySeries.attr(n(b,{anchorX:h.connectorPoint&&h.connectorPoint.plotX,anchorY:h.connectorPoint&&h.connectorPoint.plotY})).animate(g),e.options.kdNow=!0,e.buildKDTree(),e=e.searchPoint({chartX:h.x,chartY:h.y},!0),f.closest=[e,h.x-p-e.plotX,h.y-u-e.plotY])):f&&(e.labelBySeries=f.destroy())}}})},a(u.prototype,"render",i),a(u.prototype,"redraw",i)}(t)});